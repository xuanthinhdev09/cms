<style>
    #show_popup {
        position: fixed;
        z-index: 1200;
        bottom: 32px;
        left: 32px;
   }
    .custom-div {
        padding: 15px 20px;
        background: rgb(234, 234, 234);
        max-height: 0;
        opacity: 0;
        font-size: 13px;
        border-radius: 8px;
        transition: max-height 1s ease, opacity 1s ease;
        line-height: 1.6em;
    }
     .custom-div.active {
        max-height: 500px;
        opacity: 1;
        transition: max-height 1s ease, opacity 1s ease;
    }

    .custom-div .place {
        color: rgb(0, 97, 193);
        font-weight: 500;
    }

    .custom-div .image-container {
        margin-top: 16px;
        display: flex;
        align-items: flex-start;
    }

    .custom-div .image-container img {
        width: 70px;
        margin-right: 8px;
    }

    .custom-div .info-container {
        display: flex;
        flex-direction: column;
    }

    .custom-div .info-container p {
        color: rgb(0, 97, 193);
    }

    p {
        margin: 0;
    }
</style>
<div id="show_popup"></div>
<script>
    function generateRandomTime() {
        const randomMinutesAgo = Math.floor(Math.random() * 26) + 5; // Random time between 5 and 30 minutes
        return `${randomMinutesAgo} phút trước`;
    }

    const card = document.getElementById('custom-card');
    const urldefault = "{{=URL('static','%s/images')%(static_default)}}";
    const imageUrls = [
        urldefault + '/truck.png',
        urldefault + '/truck2.png',
        urldefault + '/truck3.png',
        urldefault + '/truck4.png',
        urldefault + '/truck.png',
        urldefault + '/truck2.png',
        urldefault + '/truck.png',
        urldefault + '/truck2.png',
        urldefault + '/truck3.png',
        urldefault + '/truck4.png',
        urldefault + '/truck.png',
        urldefault + '/truck.png',
        urldefault + '/truck2.png',
        urldefault + '/truck.png',

    ];
    let imageIndex = 0;
    let dataIndex = 0;

    function formatPhoneNumber(phone) {
        return phone.slice(0, phone.length / 2) + 'x'.repeat(phone.length - phone.length / 2);
    }

    function formatCurrency(value) {
        return value.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
    }

    function renderhtml(item, img){
        console.log(item);
        let data = `
            <div class="custom-div active" id="custom-card">
                <span style="color: red; font-weight: bold;">ĐƠN HÀNG MỚI NHẤT</span>
                <p>Khách: <span id="customerName">${item.customer_send.name}</span></p>
                <p id="phoneNumber">SĐT: <span id="phoneText">${formatPhoneNumber(item.customer_send.phone) }</span> - Cước: <span id="transportFee">${item.transport_fee}</span></p>
                <p> - <span id="locations">${generateRandomTime()}</span></p>
                <div class="image-container">
                    <img src="${img}" alt="" id="truckImage">
                    <div>
                        <p>Nhận đơn thành công</p>
                        <p id="truckInfo">Lái xe: ${item.trucks.name??'Đang cập nhật'}</p>
                        <p id="truckRoute">Tuyến: ${item.trucks?.router?.name??'Đang cập nhật'}</p>
                    </div>
                </div>
            </div>
        `;
        document.getElementById('show_popup').innerHTML = data;
    }

    function remmeveActive(){
        $('.custom-div').removeClass('active');
    }   

    function fetchDataAndDisplayFromAPI() {
        fetch('https://quanly.ghephang.com/gh/api_v1/getListNotice.json')
            .then(response => response.json())
            .then(data => {
                const record = data.list[dataIndex];

                let index = 0;
                setInterval(function () {
                    index = (index + 1) % data.list.length;
                    img = imageUrls[index];
                    item = data.list[index];
                    renderhtml(item, img);
                    setTimeout(remmeveActive, 7000); // 2000ms (2 giây)
                }, 14000); 
            })
            .catch(error => {
                console.error('Error fetching data from API:', error);
            });
    }

    document.addEventListener('DOMContentLoaded', fetchDataAndDisplayFromAPI);

</script>